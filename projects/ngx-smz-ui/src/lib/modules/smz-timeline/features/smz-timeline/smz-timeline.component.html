@if (state != null) {
  @if (state.items$ | async; as items) {
    @if (state.title.isVisible || headerTemplate != null || state.sources.length > 0) {
      <div class="grid grid-nogutter lg:flex-row xl:flex-row md:flex-col sm:flex-col items-center justify-between gap-2 mb-3">
        <div class="grid grid-nogutter items-center justify-start gap-2">
          @if (state.title.isVisible) {
            <div class="text-lg" [innerHtml]="state.title.getText() | safeHtml"></div>
          }
        </div>
        <div class="grid grid-nogutter items-center justify-end gap-3">
          @if (headerTemplate != null) {
            <ng-container *ngTemplateOutlet="headerTemplate; context: { $implicit: state }"></ng-container>
          }
          @if (state.sources.length > 0) {
            <p-select appendTo="body" [options]="state.sources" dataKey="key" [(ngModel)]="state.selectedSource" optionLabel="label" (onChange)="updateMainSource($event)"></p-select>
          }
        </div>
      </div>
    }
    @if (items?.length > 0) {
      <p-timeline [value]="items" [align]="state.view.align" [styleClass]="state.view.styleClass.timeline">
        <ng-template pTemplate="marker" let-event>
          <span [ngClass]="state.marker.styleClass">
            <i [ngClass]="state.marker.icon"></i>
          </span>
        </ng-template>
        <ng-template pTemplate="content" let-event>
          @if (state.template != null) {
            <smz-grid-item [isDebug]="state.isDebug" [template]="state.template" [data]="event" [menu]="state.menu" [buttons]="state.buttons" [ngClass]="state.view.styleClass.event"></smz-grid-item>
          }
        </ng-template>
      </p-timeline>
    } @else {
      <div>{{ state.locale.emptyMessage }}</div>
    }
  }
}