
@switch (mode) {
  @case (modes.GRID) {
    <ng-container *ngVar="template._context.getFlipState(data) as status">
      <div class="w-full h-full grid grid-nogutter items-center justify-center relative select-none">
        <div class="relative" [ngStyle]="{ width: template.width, height: template.height}" [ngClass]="template.cardStyleClass + (isDebug ? ' border border-red-500 border-solid' : '')">
          <div class="cmp-card w-full h-full" [ngClass]="{ 'cmp-card-flipped': status === 'back', 'cursor-pointer': template.back != null }" (click)="flip()">
            <div class="cmp-content">
              <div class="cmp-front">
                @if (status === 'front') {
                  <!-- FRONT IMAGE -->
                  @if (template.front.image; as frontImage) {
                    @if (frontImage | transformContent : data; as image) {
                      <img
                        serverImage
                        [path]="image.transform.override ? image.transform.override.dataPath : (data | cardsContent : image.dataPath).result"
                        [maximize]="image.maximize"
                        [openMaximized]="image.openMaximized"
                        [placeholder]="'assets/images/placeholder.jpeg'"
                        [title]="image.title.isVisible ? image.title.getText(data) : null"
                        [useServerPath]="image.useServerPath"
                        draggable="false"
                        [ngClass]="image.gridStyleClass"
                        >
                      }
                    }
                    @if (template.front.component; as frontComponent) {
                      <ng-template [smzInjectDataPathComponent]="frontComponent.componentData" [data]="data" [state]="template._context"></ng-template>
                    }
                    @if (template.front.html; as frontHtml) {
                      <div class="w-full h-full" [innerHTML]="frontHtml | safeHtml"></div>
                    }
                    @if (template.buttonsLocation === 'front') {
                      <ng-container *ngTemplateOutlet="buttonsTemplate; context: { $implicit: template }"></ng-container>
                    }
                    @if (template.menuLocation === 'front') {
                      <ng-container *ngTemplateOutlet="menuTemplate; context: { $implicit: template }"></ng-container>
                    }
                  }
                </div>
                <div class="cmp-back">
                  @if (status === 'back') {
                    <!-- FRONT IMAGE -->
                    @if (template.back.image; as backImage) {
                      @if (backImage | transformContent : data; as image) {
                        <img
                          serverImage
                          [path]="image.transform.override ? image.transform.override.dataPath : (data | cardsContent : image.dataPath).result"
                          [maximize]="image.maximize"
                          [openMaximized]="image.openMaximized"
                          [placeholder]="'assets/images/placeholder.jpeg'"
                          [title]="image.title.isVisible ? image.title.getText(data) : null"
                          [useServerPath]="image.useServerPath"
                          draggable="false"
                          [ngClass]="image.gridStyleClass"
                          >
                        }
                      }
                      @if (template.back.component; as backComponent) {
                        <ng-template [smzInjectDataPathComponent]="backComponent.componentData" [data]="data" [state]="template._context"></ng-template>
                      }
                      @if (template.back.html; as backHtml) {
                        <div class="w-full h-full" [innerHTML]="backHtml | safeHtml"></div>
                      }
                      @if (template.buttonsLocation === 'back') {
                        <ng-container *ngTemplateOutlet="buttonsTemplate; context: { $implicit: template }"></ng-container>
                      }
                      @if (template.menuLocation === 'back') {
                        <ng-container *ngTemplateOutlet="menuTemplate; context: { $implicit: template }"></ng-container>
                      }
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      }
      @case (modes.LIST) {
      }
    }

    <ng-template #buttonsTemplate let-template>
      <div class="absolute bottom-0 inset-x-0">
        <div class="grid grid-nogutter flex-col items-start justify-center gap-2 col" [ngClass]="template.contentStyleClass">

          <!-- BUTTONS -->
          @if (buttons.callback != null && buttons.callback(data); as buttonsData) {
            <div class="w-full grid grid-nogutter items-center justify-center gap-1">
              @for (button of buttonsData; track button; let i = $index) {
                1
                @if (button.visible) {
                  <button pButton clickStopPropagation type="button" buttonAction [item]="button" [data]="data" [label]="button.label" [icon]="button.icon" [disabled]="button.disabled" [pTooltip]="button.tooltip" class="p-button-sm px-3 py-2" [ngClass]="button.styleClass + ' ' + buttons.styleClass"></button>
                }
              }
            </div>
          }

        </div>
      </div>
    </ng-template>

    <ng-template #menuTemplate let-template>
      <!-- MENU -->
      @if (menu.callback != null && menu.callback(data); as menuItem) {
        <div class="grid grid-nogutter items-center justify-end gap-1 col-12 absolute top-2 right-2">
          <smz-menu clickStopPropagation [items]="menuItem" [data]="data" [icon]="menu.icon" [styleClass]="menu.styleClass" [buttonClass]="menu.buttonClass"></smz-menu>
        </div>
      }
    </ng-template>