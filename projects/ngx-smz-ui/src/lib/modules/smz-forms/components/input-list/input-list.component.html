<smz-label
  class="smz__input_name"
  [text]="input.name"
  [propertyName]="input.propertyName"
  [showLabel]="input.hideName == false && input.hideLabel != true"
  [warning]="input.warning">
</smz-label>

<div class="input_inner__wrapper">
  <p-listbox
    [options]="input.listBoxOptions"
    [metaKeySelection]="false"
    [checkbox]="false"
    [filter]="input.showFilter"
    optionLabel="name"
    dataKey="id"
    [listStyle]="{'height': input.height ? input.height : '200px'}"
    [style]="{'width':'100%'}"
    [styleClass]="input.styleClass"
    [disabled]="input.isDisabled"
    (onClick)="onClick($event)"
    [readonly]="isInlineEditingEnabled"
    [emptyMessage]="input.emptyMessage"
    [(ngModel)]="current">

    <ng-template pTemplate="header">
      <div class="smz__list-header">
        @if (input.showAddButton && !input.allowBatchCreation) {
          <button pButton type="button" icon="pi pi-plus" clickStopPropagation class="p-nocustom p-button-rounded p-button p-button-text" (click)="onAdd()" [disabled]="input.limitCount != null && input.listBoxOptions?.length >= input.limitCount" pTooltip="Adicionar novo item"></button>
        }
        @if (input.showAddButton && input.allowBatchCreation) {
          <button pButton type="button" icon="pi pi-plus" clickStopPropagation class="p-nocustom p-button-rounded p-button p-button-text" (click)="onAddInBatch()" pTooltip="Adicionar novos itens"></button>
        }
        @if (input.showSortButton) {
          <button pButton type="button" icon="pi pi-sort-alpha-down" clickStopPropagation class="p-nocustom p-button-rounded p-button p-button-text" (click)="onSort()" pTooltip="Reordenar"></button>
        }
        @if (input.showClearButton) {
          <button pButton type="button" icon="pi pi-trash" clickStopPropagation class="p-nocustom p-button-rounded p-button p-button-text" (click)="onClear()" pTooltip="Limpar a lista"></button>
        }
      </div>
    </ng-template>

    <ng-template let-item pTemplate="item">
      <div class="grid grid-nogutter items-center w-full justify-between">
        @if (!isInlineEditingEnabled || (isInlineEditingEnabled && current !== item)) {
          @if (input.crud?.inputType === 'float') {
            <div class="smz__list_item-title">{{ item.name | number : input.crud.digitsInfo : input.crud.labelLocale }}</div>
          } @else {
            <div class="smz__list_item-title">{{ item.name }}</div>
          }
        }

        @if (isInlineEditingEnabled && current === item) {
          @if (editForm != null) {
            <div class="col grid grid-nogutter items-center justify-center flex-gap-2 py-3 px-0" clickStopPropagation>
              <form #form [formGroup]="editForm" class="col relative">
                <input type="text" clickStopPropagation pInputText formControlName="value"/>
                @if (editForm.get('value'); as valueInput) {
                  @if (valueInput.touched && valueInput.hasError('required')) {
                    <div class="text-xs text-red-500 absolute right-3 my-1">Campo Obrigatório.</div>
                  }
                  @if (valueInput.touched && valueInput.hasError('unique')) {
                    <div class="text-xs text-red-500 absolute right-3 my-1">Já existe um item com esse nome.</div>
                  }
                }
              </form>
              <button pButton type="button" icon="pi pi-check" clickStopPropagation [disabled]="!editForm.valid" class="p-nocustom inline_action_button p-button-rounded p-button-success p-button-text" (click)="onConfirmInlineEditing(item)"></button>
              <button pButton type="button" icon="pi pi-times" clickStopPropagation class="p-nocustom inline_action_button p-button-rounded p-button-danger p-button-text" (click)="cancelEdit()"></button>
            </div>
          }
        }

        @if (current === item && !isInlineEditingEnabled) {
          <div class="smz__list_item-actions" clickStopPropagation>
            @if (input.showEditButton) {
              <button clickStopPropagation pButton type="button" icon="pi pi-pencil" class="p-nocustom p-button-rounded p-button-text" (click)="onEdit(item)"></button>
            }
            @if (input.showRemoveButton) {
              <button clickStopPropagation pButton type="button" icon="pi pi-trash" class="p-nocustom p-button-rounded p-button-text" (click)="input.askBeforeRemoveItem ? askBeforeRemove(item) : remove(item)"></button>
            }
            @if (input.showMoveButton) {
              <button clickStopPropagation pButton type="button" icon="pi pi-arrow-up" class="p-nocustom p-button-rounded p-button-text" (click)="moveUp(item)"></button>
            }
            @if (input.showMoveButton) {
              <button clickStopPropagation pButton type="button" icon="pi pi-arrow-down" class="p-nocustom p-button-rounded p-button-text" (click)="moveDown(item)"></button>
            }
          </div>
        }

      </div>
    </ng-template>

    <ng-template pTemplate="footer">
      @if (input.listBoxOptions.length === 0 && input.validatorsPreset?.isRequired) {
        <span class="col-12 smz__footer-message">*Campo obrigatório</span>
      }
      @if (input.limitCount != null && input.listBoxOptions?.length === input.limitCount) {
        <span class="col-12 smz__footer-message text-blue-300">*Limite atingido.</span>
      }
      @if (input.limitCount != null && input.listBoxOptions?.length > input.limitCount) {
        <span class="col-12 smz__footer-message">*Limite ultrapassado</span>
      }
    </ng-template>
  </p-listbox>
</div>