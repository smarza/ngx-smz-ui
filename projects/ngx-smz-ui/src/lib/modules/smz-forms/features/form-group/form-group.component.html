@if (config != null) {
  <div class="smz_form_grid_container">
    @if (viewdata?.form != null && !configHasErrors) {
      <form focusFirstInput [focus]="!config.behaviors.avoidFocusOnLoad" [formGroup]="viewdata.form" class="smz_form__wrapper" (submit)="$event.preventDefault()" (keydown.enter)="onEnter($event)">
        <ng-container *ngTemplateOutlet="groupTemplate"></ng-container>
      </form>
    }
    @if (configHasErrors) {
      <div>Error</div>
    }
  </div>
}

<ng-template #groupTemplate>

  <div class="w-full px-0 mx-auto">
    <div class="grid grid-nogutter flex-wrap items-start justify-start flex-gap-2" [ngClass]="config.template | setTemplateClasses : ['horizontalAlignment', 'verticalAlignment']">
      @for (group of config.groups; track group) {
        @if (!group.isHide) {
          <div class="col" [ngClass]="group.template | setTemplateClasses : ['row']">
            @if (group.showName) {
              <div class="smz__group_name">{{ group.name }}</div>
            }
            <div [ngClass]="group.styleClass ?? 'grid grid-nogutter flex-wrap items-start justify-start flex-gap-2'">
              @for (input of group.children; track input) {
                @if (input.isVisible) {
                  <div class="input__control__wrapper col" [ngClass]="input.template | setTemplateClasses : ['row'] : [input.styleClass, group.inputStyleClass]">
                    <ng-container *ngTemplateOutlet="inputTemplate; context: { $implicit: input }"></ng-container>
                  </div>
                }
              }
            </div>
          </div>
        }
      }
    </div>
  </div>

</ng-template>

<ng-template #inputTemplate let-input>

  @if (input.type == controlTypes.PASSWORD) {
    <smz-input-password [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-input-password>
  }

  @if (input.type == controlTypes.TEXT_MASK) {
    <smz-input-mask [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-input-mask>
  }

  @if (input.type == controlTypes.TEXT) {
    <smz-input-text [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-input-text>
  }

  @if (input.type == controlTypes.LIST) {
    <smz-input-list [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-input-list>
  }

  @if (input.type == controlTypes.NUMBER) {
    <smz-input-number [input]="input" [form]="viewdata.form" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-input-number>
  }

  @if (input.type == controlTypes.TEXT_AREA) {
    <smz-input-text-area [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-input-text-area>
  }

  @if (input.type == controlTypes.CONTENT_MASK) {
    <smz-input-content-mask [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-input-content-mask>
  }

  @if (input.type == controlTypes.TAG_AREA) {
    <input-tag-area [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></input-tag-area>
  }

  @if (input.type == controlTypes.AUTOCOMPLETE_TAG_AREA) {
    <smz-input-autocomplete-tag-area [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-input-autocomplete-tag-area>
  }

  @if (input.type == controlTypes.RADIO) {
    <smz-radio-button [input]="input" [control]="viewdata.form.controls[input.propertyName]" [formId]="config.formId" [behaviors]="config.behaviors"></smz-radio-button>
  }

  @if (input.type == controlTypes.SWITCH) {
    <smz-input-switch [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-input-switch>
  }

  @if (input.type == controlTypes.CHECKBOX) {
    <smz-checkbox [input]="input" [control]="viewdata.form.controls[input.propertyName]" [formId]="config.formId" [behaviors]="config.behaviors"></smz-checkbox>
  }

  @if (input.type == controlTypes.CHECKBOX_GROUP) {
    <smz-checkbox-group [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-checkbox-group>
  }

  @if (input.type == controlTypes.CALENDAR) {
    <smz-calendar [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-calendar>
  }

  @if (input.type == controlTypes.DROPDOWN) {
    <smz-dropdown [input]="input" [control]="viewdata.form.controls[input.propertyName]" [formId]="config.formId" [behaviors]="config.behaviors"></smz-dropdown>
  }

  @if (input.type == controlTypes.LINKED_DROPDOWN) {
    <smz-linked-dropdown [input]="input" [control]="viewdata.form.controls[input.propertyName]" [formId]="config.formId" [behaviors]="config.behaviors"></smz-linked-dropdown>
  }

  @if (input.type == controlTypes.FILE) {
    <smz-file-upload [input]="input" [control]="viewdata.form.controls[input.propertyName]" [form]="viewdata.form" [behaviors]="config.behaviors"></smz-file-upload>
  }

  @if (input.type == controlTypes.CURRENCY) {
    <smz-input-currency [input]="input" [control]="viewdata.form.controls[input.propertyName]" [behaviors]="config.behaviors"></smz-input-currency>
  }

  @if (input.type == controlTypes.MULTI_SELECT) {
    <smz-multi-select [input]="input" [control]="viewdata.form.controls[input.propertyName]" [formId]="config.formId" [behaviors]="config.behaviors"></smz-multi-select>
  }

  @if (input.type == controlTypes.LINKED_MULTISELECT) {
    <smz-linked-multi-select [input]="input" [control]="viewdata.form.controls[input.propertyName]" [formId]="config.formId" [behaviors]="config.behaviors"></smz-linked-multi-select>
  }

  @if (input.type == controlTypes.COLOR_PICKER) {
    <smz-color-picker [input]="input" [control]="$any(viewdata.form.controls[input.propertyName])" [behaviors]="config.behaviors"></smz-color-picker>
  }

  @if (input.type == controlTypes.TEXT_BUTTON) {
    <smz-input-text-button [input]="input" [control]="viewdata.form.controls[input.propertyName]" [viewdata]="viewdata" [behaviors]="config.behaviors"></smz-input-text-button>
  }

  @if (input.type == controlTypes.TREE) {
    <smz-input-tree [input]="input" [control]="viewdata.form.controls[input.propertyName]" [formId]="config.formId" [behaviors]="config.behaviors"></smz-input-tree>
  }

</ng-template>
